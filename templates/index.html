{% extends 'base.html' %}

{% block title %}Dashboard - Brain Spectrogram{% endblock %}

{% block content %}
<div class="row mb-4 fade-in">
  <div class="col-md-12 text-center">
    <h1 class="display-5 fw-bold mb-3 text-gradient">
      <i class="fas fa-brain text-primary"></i> Brain Spectrogram Dashboard
    </h1>
    <p class="lead text-muted">
      Spectrogram-Based Deep Learning for EEG Signal Analysis & ASD Detection
    </p>
  </div>
</div>

<!-- Stats -->
<div class="row text-center mb-4">
  <div class="col-md-4 mb-3">
    <div class="stat-card">
      <i class="fas fa-users fa-3x mb-3 text-success"></i>
      <h2 class="counter" data-target="{{ total_patients }}">0</h2>
      <p class="fw-semibold">Total Patients</p>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="stat-card">
      <i class="fas fa-file-medical fa-3x mb-3 text-primary"></i>
      <h2 class="counter" data-target="{{ total_records }}">0</h2>
      <p class="fw-semibold">EEG Records</p>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="stat-card">
      <i class="fas fa-brain fa-3x mb-3 text-info"></i>
      <h2 class="counter" data-target="{{ total_analyses }}">0</h2>
      <p class="fw-semibold">Analyses Completed</p>
    </div>
  </div>
</div>

<!-- Recent Patients -->
<div class="card fade-in">
  <div class="card-header bg-gradient">
    <i class="fas fa-users"></i> Recent Patients
    <a href="{{ url_for('add_patient') }}" class="btn btn-sm btn-light float-end shadow-sm">
      <i class="fas fa-plus"></i> Add Patient
    </a>
  </div>
  <div class="card-body">
    {% if patients %}
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th><i class="fas fa-id-card"></i> ID</th>
            <th><i class="fas fa-user"></i> Name</th>
            <th><i class="fas fa-cake-candles"></i> Age</th>
            <th><i class="fas fa-venus-mars"></i> Gender</th>
            <th><i class="fas fa-stethoscope"></i> Diagnosis</th>
            <th><i class="fas fa-file-waveform"></i> EEG Records</th>
            <th><i class="fas fa-calendar"></i> Added On</th>
            <th><i class="fas fa-gear"></i> Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for patient in patients[:10] %}
          <tr>
            <td>{{ patient.id }}</td>
            <td class="fw-bold">{{ patient.name }}</td>
            <td>{{ patient.age }}</td>
            <td>{{ patient.gender }}</td>
            <td>
              {% if patient.diagnosis %}
                <span class="badge bg-info">{{ patient.diagnosis }}</span>
              {% else %}
                <span class="badge bg-secondary">N/A</span>
              {% endif %}
            </td>
            <td>
              <span class="badge bg-primary">{{ patient.eeg_records|length }}</span>
            </td>
             <td>{{ patient.created_at.strftime('%Y-%m-%d') }}</td>  

            <td>
  <!-- View Patient -->
  <a href="{{ url_for('patient_detail', id=patient.id) }}" class="action-btn" title="View Patient">
    <i class="fas fa-eye"></i>
  </a>

  <!-- Edit Patient -->
  <a href="{{ url_for('update_patient', id=patient.id) }}" class="action-btn" title="Edit Patient">
    <i class="fas fa-pen-to-square"></i>
  </a>

  <!-- Upload EEG -->
  <a href="{{ url_for('upload_choice', patient_id=patient.id) }}" class="action-btn" title="Upload ">
    <i class="fas fa-upload"></i>
  </a>

  <!-- Delete Patient -->
  <a href="{{ url_for('delete_patient', id=patient.id) }}"
     class="action-btn text-danger" title="Delete Patient"
     onclick="return confirm('Are you sure you want to delete this patient and all EEG records?');">
    <i class="fas fa-trash"></i>
  </a>
</td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-5">
      <i class="fas fa-users fa-4x text-muted mb-3"></i>
      <h5>No patients found</h5>
      <p class="text-muted">Start by adding your first patient record.</p>
      <a href="{{ url_for('add_patient') }}" class="btn btn-primary shadow-sm">
        <i class="fas fa-user-plus"></i> Add Patient
      </a>
    </div>
    {% endif %}
  </div>
</div>

<!-- Features and Quick Actions -->
<div class="row mt-4">
  <div class="col-md-6 fade-in">
    <div class="card">
      <div class="card-header bg-gradient">
        <i class="fas fa-star"></i> System Features
      </div>
      <div class="card-body">
        <ul class="list-unstyled mb-0">
          <li><i class="fas fa-check-circle text-success"></i> EEG Signal Processing</li>
          <li><i class="fas fa-check-circle text-success"></i> Spectrogram Generation</li>
          <li><i class="fas fa-check-circle text-success"></i> Visual Stimuli Classification</li>
          <li><i class="fas fa-check-circle text-success"></i> ASD Detection</li>
          <li><i class="fas fa-check-circle text-success"></i> Deep Learning Analysis</li>
        </ul>
      </div>
    </div>
  </div>
  <div class="col-md-6 fade-in">
    <div class="card">
      <div class="card-header bg-gradient">
        <i class="fas fa-bolt"></i> Quick Actions
      </div>
      <div class="card-body d-grid gap-2">
        <a href="{{ url_for('add_patient') }}" class="btn btn-primary">
          <i class="fas fa-user-plus"></i> Add New Patient
        </a>
        <a href="{{ url_for('patients') }}" class="btn btn-success">
          <i class="fas fa-list"></i> View All Patients
        </a>
        <a href="{{ url_for('analyses') }}" class="btn btn-info">
          <i class="fas fa-chart-line"></i> View All Analyses
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Counter Animation -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const counters = document.querySelectorAll(".counter");
  counters.forEach(counter => {
    counter.innerText = "0";
    const update = () => {
      const target = +counter.getAttribute("data-target");
      const current = +counter.innerText;
      const increment = Math.ceil(target / 50);
      if (current < target) {
        counter.innerText = current + increment;
        setTimeout(update, 30);
      } else {
        counter.innerText = target;
      }
    };
    update();
  });
});
</script>
{% endblock %}
