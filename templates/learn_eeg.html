{% extends "base.html" %}
{% block title %}Interactive Learning | Brain Spectrogram{% endblock %}

{% block content %}

<style>
    .section-card {
        background: #0a1a3a;
        color: #ffffff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0,0,0,0.4);
        margin-bottom: 25px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .section-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }
    h2, h3 {
        color: #76a9ff;
        font-weight: 700;
    }
    .divider {
        height: 2px;
        background: #264a96;
        margin: 15px 0;
    }
    .upload-box {
        background: #10224d;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid #274f9e;
    }
    .btn-custom {
        background: #3a6afc;
        color: white;
        font-weight: bold;
        border-radius: 8px;
        padding: 10px 25px;
        border: none;
        cursor: pointer;
        transition: background 0.3s ease;
    }
    .btn-custom:hover {
        background: #2a5aec;
    }
    .loading-spinner {
        display: none;
        margin-top: 15px;
        text-align: center;
    }
    .loading-spinner div {
        width: 40px;
        height: 40px;
        border: 4px solid #76a9ff;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: auto;
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    .alert-custom {
        background: #1a3a5a;
        border: 2px solid #3a6afc;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        color: #ffffff;
        white-space: pre-line;
    }
    .detailed-btn-form {
        margin-top: 15px;
    }
</style>

<div class="container py-5">

    <!-- PAGE TITLE -->
    <h2 class="text-center mb-4">üß† Interactive EEG Learning Zone</h2>
    <p class="text-center mb-4 text-light" style="font-size: 17px;">
        A simplified, educational walkthrough of EEG patterns, spectrograms, brainwave frequencies,
        seizure features, ASD-related observations, and visual understanding of uploaded spectrograms or reports.
        <br>
        <b>This module is for learning purposes only ‚Äî not medical diagnosis.</b>
    </p>

    <!-- SECTION 1: What is EEG -->
    <div class="section-card">
        <h3>üìò What is EEG?</h3>
        <div class="divider"></div>
        <p>
            EEG (Electroencephalography) records brain activity through electrodes placed on the scalp.
            These recordings help visualize how different brain regions fire over time.
        </p>
        <ul>
            <li>Measures voltage fluctuations of neurons</li>
            <li>Captures rhythmic brainwave patterns</li>
            <li>Forms the base data for spectrogram visualizations</li>
        </ul>
    </div>

    <!-- SECTION 2: How Spectrograms Work -->
    <div class="section-card">
        <h3>üé® How Spectrograms Work</h3>
        <div class="divider"></div>
        <p>
            A spectrogram represents frequency (vertical axis) versus time (horizontal axis),
            with color intensity indicating signal power.
        </p>
        <ul>
            <li><b>Bright colors:</b> high energy</li>
            <li><b>Darker colors:</b> low energy</li>
            <li><b>Lower frequencies</b> at the bottom, <b>higher frequencies</b> at the top</li>
        </ul>
    </div>

    <!-- SECTION 3: Brain Frequency Bands -->
    <div class="section-card">
        <h3>üì° Brain Frequency Bands</h3>
        <div class="divider"></div>
        <ul>
            <li><b>Delta (0‚Äì4 Hz):</b> Deep sleep, slow-wave activity</li>
            <li><b>Theta (4‚Äì8 Hz):</b> Relaxation, drowsiness</li>
            <li><b>Alpha (8‚Äì13 Hz):</b> Calm, eyes-closed resting state</li>
            <li><b>Beta (13‚Äì30 Hz):</b> Active thinking, alertness</li>
            <li><b>Gamma (30+ Hz):</b> High cognitive processing, memory</li>
        </ul>
    </div>

    <!-- SECTION 4: Seizure Patterns -->
    <div class="section-card">
        <h3>‚ö° Seizure EEG Patterns (Educational Only)</h3>
        <div class="divider"></div>
        <p>Seizure-like EEG may show:</p>
        <ul>
            <li>Sudden bursts of high amplitude</li>
            <li>Repetitive spike-and-wave discharges</li>
            <li>High-frequency oscillations</li>
        </ul>
    </div>

    <!-- SECTION 5: ASD Patterns -->
    <div class="section-card">
        <h3>üåà ASD EEG Pattern Trends (Research-Based, Non-Diagnostic)</h3>
        <div class="divider"></div>
        <p>Research literature commonly notes:</p>
        <ul>
            <li>Reduced Alpha-band power in some regions</li>
            <li>Increased Gamma variability</li>
            <li>Altered long-distance connectivity</li>
        </ul>
    </div>

    <!-- SECTION 6: Upload Spectrogram -->
    <div class="section-card">
        <h3>üî§ Upload a Spectrogram & Learn the Pattern</h3>
        <div class="divider"></div>
        <p class="mb-3">Upload your EEG spectrogram image (PNG, JPG, or JPEG) to get a detailed educational analysis of the patterns visible in your brain activity recording.</p>

        <form action="{{ url_for('learn_eeg') }}" method="post" enctype="multipart/form-data" class="upload-box mt-3" onsubmit="showLoading(event)">
            <label class="form-label">Select EEG Spectrogram Image:</label>
            <input type="file" name="eeg_file" class="form-control mb-3" accept=".png,.jpg,.jpeg" required>
            <button type="submit" class="btn btn-custom">Analyze Pattern</button>
        </form>

        <div class="loading-spinner"><div></div></div>

        {% if analysis_result %}

<div class="alert-custom">
    <strong>üìä Pattern Analysis Result:</strong>
    <hr style="border-color: #3a6afc;">

    <!-- Show EEG image -->
    {% if analysis_result.images %}
        <img src="{{ analysis_result.images[0] }}" class="img-fluid mb-3" style="border-radius: 10px; max-width: 300px;">
    {% endif %}

    <!-- Short Explanation -->
    {% if analysis_result.short_explanation %}
        <p>{{ analysis_result.short_explanation }}</p>
    {% else %}
        <p>{{ analysis_result.explanation[:250] }}...</p>
    {% endif %}

    <!-- Detailed Explanation Button -->
   <form action="{{ url_for('learn_eeg_details') }}" method="get" target="_blank">
    <button type="submit" class="btn btn-custom mt-2">üìñ View Detailed Explanation</button>
</form>


</div>

{% endif %}

    </div>

    <!-- SECTION 7: Upload Report -->
    <div class="section-card">
        <h3>üìÑ Upload a Report & Get Detailed Insights</h3>
        <div class="divider"></div>
        <p class="mb-3">Upload your EEG analysis report (PDF, DOCX, TXT, CSV, JSON, or image of charts) to receive a comprehensive educational breakdown including detected patterns, confidence scores, risk assessment, and precautionary guidance.</p>

        <form action="{{ url_for('learn_eeg') }}" method="post" enctype="multipart/form-data" class="upload-box mt-3" onsubmit="showLoading(event)">
            <label class="form-label">Select Report File:</label>
            <input type="file" name="report_file" class="form-control mb-3" accept=".txt,.csv,.json,.pdf,.docx,.png,.jpg,.jpeg" required>
            <button type="submit" class="btn btn-custom">Analyze Report</button>
        </form>

        <div class="loading-spinner"><div></div></div>

        {% if report_analysis %}
        <!-- Summary Display -->
        <div class="alert-custom">
            <strong>üìã Report Summary:</strong>
            <hr style="border-color: #3a6afc;">
            {{ report_analysis }}
        </div>

        <!-- Detailed Explanation Button -->
        <!-- Detailed Explanation Button -->
{% if report_analysis and report_analysis.points %}
<form action="{{ url_for('learn_eeg_report_details') }}" method="post" class="detailed-btn-form" target="_blank">
    <input type="hidden" name="report_points" value="{{ report_analysis.points | join('||') }}">
    <button type="submit" class="btn btn-custom mt-2">üìñ View Detailed Report Explanation</button>
</form>
{% endif %}

        {% endif %}
    </div>

    <!-- DISCLAIMER -->
    <div class="section-card" style="background: #1a0a2a; border: 2px solid #ff6b6b;">
        <h3 style="color: #ff6b6b;">‚ö†Ô∏è Important Disclaimer</h3>
        <div class="divider" style="background: #ff6b6b;"></div>
        <p>
            <b>This tool is for educational purposes only.</b> It is NOT a medical device and does NOT provide medical diagnosis, treatment, or professional advice. 
            Always consult qualified healthcare professionals for medical concerns. The analyses provided here are based on pattern recognition and statistical models, 
            not clinical expertise. Do not make health decisions based solely on this tool's output.
        </p>
    </div>

</div>

<script>
function showLoading(event) {
    // Show loading spinner for the form that was submitted
    const form = event.target;
    const spinner = form.parentElement.querySelector('.loading-spinner');
    if (spinner) {
        spinner.style.display = 'block';
    }
}
</script>

{% endblock %}