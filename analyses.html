{% extends 'base.html' %}

{% block title %}Analyses Dashboard{% endblock %}

{% block content %}

<style>
/* ===================== */
/*  BADGE STYLING */
/* ===================== */
.badge-asd {
    background: linear-gradient(135deg, #e03131, #c2255c);
    color: #fff;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 8px;
}

.badge-stimulus {
    background: linear-gradient(135deg, #339af0, #1c7ed6);
    color: #fff;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 8px;
}

.badge-frequency {
    background: linear-gradient(135deg, #20c997, #099268);
    color: #fff;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 8px;
}

.table tbody tr:hover {
    background: #f8fbff;
    transition: 0.2s ease;
}

.progress {
    height: 10px;
    border-radius: 10px;
}

.action-btn {
    font-size: 1.1rem;
    color: #1c7ed6;
}
.action-btn:hover {
    color: #0b5ed7;
}
</style>


<div class="container mt-4">

    <h2 class="mb-4">
        <i class="fas fa-chart-line text-primary"></i> Analyses Dashboard
    </h2>

    <div class="card shadow-sm mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <strong><i class="fas fa-list"></i> All Analyses</strong>
            <span class="text-muted small">{{ analyses|length }} total</span>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead>
                    <tr>
                        <th># ID</th>
                        <th><i class="fas fa-wave-square"></i> Type</th>
                        <th><i class="fas fa-user"></i> Patient</th>
                        <th><i class="fas fa-check-circle"></i> Result</th>
                        <th><i class="fas fa-percent"></i> Confidence</th>
                        <th><i class="fas fa-calendar"></i> Date</th>
                        <th><i class="fas fa-eye"></i> Action</th>
                    </tr>
                </thead>

                <tbody>

                    {% for analysis in analyses %}
                    <tr>
                        <td>{{ analysis.id }}</td>

                        <td>
                            {% if analysis.analysis_type == 'asd_detection' %}
                                <span class="badge-asd"><i class="fas fa-brain me-1"></i> ASD Detection</span>

                            {% elif analysis.analysis_type == 'stimulus_classification' %}
                                <span class="badge-stimulus"><i class="fas fa-eye me-1"></i> Stimulus Classification</span>

                            {% elif analysis.analysis_type == 'frequency_analysis' %}
                                <span class="badge-frequency"><i class="fas fa-wave-square me-1"></i> Frequency Analysis</span>

                            {% else %}
                                <span class="badge bg-secondary">{{ analysis.analysis_type }}</span>
                            {% endif %}
                        </td>

                        <!-- ðŸ”¥ FIXED: Correct Patient Mapping -->
                        <td>{{ analysis.eeg_record.patient.name }}</td>

                        <td><strong>{{ analysis.result }}</strong></td>

                        <td style="width: 150px;">
                            <div class="progress">
                                <div class="progress-bar bg-success" role="progressbar"
                                    style="width: {{ analysis.confidence * 100 }}%;">
                                </div>
                            </div>
                            <span class="small text-muted">{{ (analysis.confidence * 100)|round(1) }}%</span>
                        </td>

                        <td>{{ analysis.created_at.strftime('%Y-%m-%d %H:%M') }}</td>

                        <td>
                            <a href="{{ url_for('analysis_detail', id=analysis.id) }}" class="action-btn">
                                <i class="fas fa-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}

                </tbody>

            </table>
        </div>

    </div>

</div>

{% endblock %}